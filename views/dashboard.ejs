<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - YouTube Auto Order</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ YouTube Auto Order Tool</h1>
            <p>Powered by TUTMXH.COM API - Ch·∫°y 24/7</p>
            <a href="/logout" class="logout-btn">ƒêƒÉng xu·∫•t</a>
        </div>

        <div class="content">
            <!-- API Configuration -->
            <div class="section">
                <h2>‚öôÔ∏è C·∫•u h√¨nh API</h2>
                <div class="form-group">
                    <label>API Key:</label>
                    <input type="text" id="apiKey" value="<%= apiKey %>" placeholder="Nh·∫≠p API key t·ª´ TUTMXH.COM">
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="balance">$<%= balance %></div>
                        <div class="stat-label">S·ªë d∆∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= totalChannels %></div>
                        <div class="stat-label">T·ªïng s·ªë k√™nh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= runningChannels %></div>
                        <div class="stat-label">ƒêang ch·∫°y</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button onclick="saveApiKey()">üíæ L∆∞u API Key</button>
                    <button onclick="checkBalance()" class="success">üí∞ Ki·ªÉm tra s·ªë d∆∞</button>
                    <button onclick="loadServices()" class="warning">üîÑ T·∫£i d·ªãch v·ª•</button>
                </div>
            </div>

            <!-- Channel Management -->
            <div class="section">
                <h2>üì∫ Qu·∫£n l√Ω k√™nh (<%= channels.length %>)</h2>
                <button onclick="showAddChannelModal()">‚ûï Th√™m k√™nh m·ªõi</button>
                <button onclick="startAllChannels()" class="success">‚ñ∂Ô∏è Ch·∫°y t·∫•t c·∫£</button>
                <button onclick="stopAllChannels()" class="danger">‚èπÔ∏è D·ª´ng t·∫•t c·∫£</button>
                
                <div id="channelsList" style="margin-top: 20px;">
                    <% if (channels.length === 0) { %>
                        <div class="no-data">Ch∆∞a c√≥ k√™nh n√†o. Nh·∫•n "Th√™m k√™nh m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>
                    <% } else { %>
                        <% channels.forEach(channel => { %>
                            <div class="channel-card <%= channel.is_running ? 'running' : 'stopped' %>">
                                <div class="channel-header">
                                    <div class="channel-info">
                                        <div class="channel-name">üì∫ <%= channel.name %></div>
                                        <div class="channel-id">ID: <%= channel.id %></div>
                                        <% if (channel.last_checked) { %>
                                            <div class="last-check">
                                                Ki·ªÉm tra l·∫ßn cu·ªëi: <%= new Date(channel.last_checked).toLocaleString('vi-VN') %>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="channel-status">
                                        <span class="status-badge <%= channel.is_running ? 'status-running' : 'status-stopped' %>">
                                            <%= channel.is_running ? '‚ñ∂Ô∏è ƒêang ch·∫°y' : '‚èπÔ∏è ƒê√£ d·ª´ng' %>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="schedule-info">
                                    ‚è∞ L·ªãch ki·ªÉm tra: <%= channel.schedule || 'M·ªói 5 ph√∫t' %>
                                </div>
                                
                                <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 13px;">
                                    üéØ Lo·∫°i n·ªôi dung: 
                                    <% if (channel.content_type === 'video_only') { %>
                                        üìπ Ch·ªâ video th∆∞·ªùng
                                    <% } else if (channel.content_type === 'livestream_only') { %>
                                        üî¥ Ch·ªâ livestream
                                    <% } else { %>
                                        üé¨ C·∫£ hai
                                    <% } %>
                                </div>
                                
                                <div class="channel-services">
                                    <strong>üéØ D·ªãch v·ª• ƒëang ch·∫°y:</strong><br>
                                    <small>
                                        <% if (channel.services.length > 0) { %>
                                            <%= channel.services.map(s => {
                                                const service = allServices.find(as => as.service == s.service_id);
                                                return service ? `${service.name} (${s.quantity})` : `Service #${s.service_id} (${s.quantity})`;
                                            }).join(', ') %>
                                        <% } else { %>
                                            Ch∆∞a ch·ªçn d·ªãch v·ª•
                                        <% } %>
                                    </small>
                                </div>
                                
                                <div class="channel-stats">
                                    <div class="stat-item">
                                        <div class="stat-value"><%= channel.stats.videosProcessed %></div>
                                        <div class="stat-label">Video x·ª≠ l√Ω</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value"><%= channel.stats.ordersCreated %></div>
                                        <div class="stat-label">ƒê∆°n t·∫°o</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value"><%= channel.videosCount %></div>
                                        <div class="stat-label">Video trong l·ªãch s·ª≠</div>
                                    </div>
                                </div>
                                
                                <div class="channel-controls">
                                    <% if (!channel.is_running) { %>
                                        <button class="success" onclick="startChannel('<%= channel.id %>')">‚ñ∂Ô∏è Ch·∫°y</button>
                                    <% } else { %>
                                        <button class="danger" onclick="stopChannel('<%= channel.id %>')">‚èπÔ∏è D·ª´ng</button>
                                    <% } %>
                                    <button class="warning" onclick="showEditChannelModal('<%= channel.id %>')">‚úèÔ∏è S·ª≠a</button>
                                    <button onclick="viewChannelHistory('<%= channel.id %>')">üìã L·ªãch s·ª≠</button>
                                    <button class="danger" onclick="deleteChannel('<%= channel.id %>')">üóëÔ∏è X√≥a</button>
                                </div>
                            </div>
                        <% }) %>
                    <% } %>
                </div>
            </div>

            <!-- Logs -->
            <div class="section">
                <h2>üìù Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</h2>
                <button onclick="loadLogs()">üîÑ T·∫£i l·∫°i</button>
                <button onclick="clearLogs()" class="danger">üßπ X√≥a logs</button>
                <div id="logs" class="logs" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <!-- Add Channel Modal -->
    <div id="addChannelModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeAddChannelModal()">&times;</span>
            <div class="modal-header">‚ûï Th√™m k√™nh m·ªõi</div>
            
            <div class="form-group">
                <label>T√™n k√™nh:</label>
                <input type="text" id="newChannelName" placeholder="VD: K√™nh Gaming c·ªßa t√¥i">
            </div>
            
            <div class="form-group">
                <label>Channel ID:</label>
                <input type="text" id="newChannelId" placeholder="UCxxxxxxx...">
                <small style="color: #666; display: block; margin-top: 5px;">
                    üí° L·∫•y t·ª´ URL: youtube.com/channel/<strong>UCxxx...</strong>
                </small>
            </div>
            
            <div class="form-group">
                <label>L·ªãch ki·ªÉm tra (ƒë·ªÉ tr·ªëng = m·ªói 5 ph√∫t):</label>
                <input type="text" id="newChannelSchedule" placeholder="VD: 17:00,17:01,17:02,18:00">
                <small style="color: #666; display: block; margin-top: 5px;">
                    ‚è∞ H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ch·∫°y v√†o ƒë√∫ng gi·ªù ƒë√£ l√™n l·ªãch
                </small>
            </div>
            
            <div class="form-group">
                <label>Lo·∫°i n·ªôi dung:</label>
                <select id="newChannelContentType">
                    <option value="both">üé¨ C·∫£ video th∆∞·ªùng v√† livestream</option>
                    <option value="video_only">üìπ Ch·ªâ video th∆∞·ªùng</option>
                    <option value="livestream_only">üî¥ Ch·ªâ livestream</option>
                </select>
                <small style="color: #666; display: block; margin-top: 5px;">
                    <% if (process.env.YOUTUBE_API_KEY) { %>
                        ‚úÖ YouTube API ƒë√£ c·∫•u h√¨nh - C√≥ th·ªÉ ph√¢n bi·ªát livestream
                    <% } else { %>
                        ‚ö†Ô∏è Ch∆∞a c·∫•u h√¨nh YouTube API Key - Kh√¥ng th·ªÉ ph√¢n bi·ªát livestream
                    <% } %>
                </small>
            </div>
            
            <h3 style="margin: 20px 0 10px 0; color: #667eea;">Ch·ªçn d·ªãch v·ª•:</h3>
            <div id="modalServicesList" style="max-height: 300px; overflow-y: auto;"></div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="addNewChannel()">‚úÖ Th√™m k√™nh</button>
                <button class="danger" onclick="closeAddChannelModal()">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <!-- Edit Channel Modal -->
    <div id="editChannelModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeEditChannelModal()">&times;</span>
            <div class="modal-header">‚úèÔ∏è Ch·ªânh s·ª≠a k√™nh</div>
            <input type="hidden" id="editChannelId">
            
            <div class="form-group">
                <label>T√™n k√™nh:</label>
                <input type="text" id="editChannelName">
            </div>
            
            <div class="form-group">
                <label>L·ªãch ki·ªÉm tra:</label>
                <input type="text" id="editChannelSchedule" placeholder="VD: 17:00,18:00">
            </div>
            
            <div class="form-group">
                <label>Lo·∫°i n·ªôi dung:</label>
                <select id="editChannelContentType">
                    <option value="both">üé¨ C·∫£ video th∆∞·ªùng v√† livestream</option>
                    <option value="video_only">üìπ Ch·ªâ video th∆∞·ªùng</option>
                    <option value="livestream_only">üî¥ Ch·ªâ livestream</option>
                </select>
            </div>
            
            <h3 style="margin: 20px 0 10px 0; color: #667eea;">D·ªãch v·ª•:</h3>
            <div id="editServicesList" style="max-height: 300px; overflow-y: auto;"></div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="saveChannelEdit()">üíæ L∆∞u thay ƒë·ªïi</button>
                <button class="danger" onclick="closeEditChannelModal()">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <script>
        const allServices = <%- JSON.stringify(allServices) %>;
        const channelsData = <%- JSON.stringify(channels) %>;
    </script>
    <script src="/js/app.js"></script>
</body>
</html>
